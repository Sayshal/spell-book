{{!--
/**
 * Wizard Spell Item Component Template
 *
 * PURPOSE:
 * Individual spell item component for displaying spell details with wizard-specific
 * actions in wizardbook tabs. Provides spell learning controls, spellbook status
 * indicators, and scroll-based learning functionality exclusive to wizard characters.
 *
 * ACCESSIBILITY FEATURES:
 * - Semantic list item structure for screen readers
 * - Button elements with proper aria-label attributes
 * - Tooltip data attributes for additional context
 * - Action buttons with descriptive labels and ARIA attributes
 * - Status indicators with accessible labels
 * - Accessible icon markup with aria-hidden for decorative elements
 *
 * WIZARD-SPECIFIC FEATURES:
 * - Learn from scroll button: Appears when spell is available from a scroll item
 * - Learn spell button: Standard spell learning for spells not yet in spellbook
 * - In spellbook tag: Status indicator for spells already learned
 * - Conditional display based on spell level (cantrips cannot be learned)
 * - Integration with wizard spell learning mechanics and gold cost system
 *
 *
 * INTEGRATION:
 * - Used within spell-level component via partial rendering for wizard tabs only
 * - Supports player spell book wizardbook tabs exclusively
 * - Connects to wizard spell learning system and scroll scanner
 * - Integrates with spell comparison, favorites, and notes systems
 * - Works with filter and search systems via data attributes
 * - Triggers wizard-specific dialogs for spell learning confirmation
 */
--}}

<li class="{{spell.cssClasses}}" {{{spell.dataAttributes}}}>
  <div class="spell-name">
    {{{spell.enrichedIcon}}}
    <div class="name-stacked">
      <span class="title">
        {{spell.name}}

        {{!-- Favorite Star Button --}}
        {{#if spell.favoriteButton.enabled}}
          <button type="button" class="spell-favorite-toggle {{#if spell.favoriteButton.favorited}}favorited{{/if}}"
            data-action="toggleFavorite" data-uuid="{{spell.favoriteButton.uuid}}"
            data-tooltip="{{spell.favoriteButton.tooltip}}" aria-label="{{spell.favoriteButton.tooltip}}">
            <i class="{{spell.favoriteButton.iconClass}} fa-star" aria-hidden="true"></i>
          </button>
        {{/if}}

        {{!-- Spell Tag --}}
        {{#if spell.tag}}
          <span class="tag {{spell.tag.cssClass}}" {{#if spell.tag.tooltip}}data-tooltip="{{spell.tag.tooltip}}"
            {{/if}}>
            {{spell.tag.text}}
          </span>
        {{/if}}

        {{!-- Party Member Icons --}}
        {{#if spell.partyIcons.enabled}}
          <span class="party-icons">
            {{#each spell.partyIcons.icons as |icon|}}
              <img src="{{icon.src}}" class="party-member-icon" data-tooltip="{{icon.name}}"
                data-actor-id="{{icon.actorId}}" style="box-shadow: 0 0 0.1rem 0.1rem {{icon.userColor}};">
            {{/each}}
          </span>
        {{/if}}
      </span>

      {{!-- Subtitle with Icons and Metadata --}}
      {{#if (or spell.comparisonIcon.enabled spell.notesIcon.enabled spell.formattedDetails)}}
        <span class="subtitle" {{#if spell.materialComponentsTooltip}}data-tooltip="{{spell.materialComponentsTooltip}}"
          {{/if}}>
          {{!-- Comparison Icon --}}
          {{#if spell.comparisonIcon.enabled}}
            <i class="fa-solid fa-clipboard-question spell-compare-icon{{#if spell.comparisonIcon.active}} active{{/if}}"
              data-action="compareSpell" data-uuid="{{spell.comparisonIcon.uuid}}"
              data-tooltip="{{spell.comparisonIcon.tooltip}}" aria-label="{{spell.comparisonIcon.ariaLabel}}"></i>
          {{/if}}

          {{!-- Notes Icon --}}
          {{#if spell.notesIcon.enabled}}
            <i class="{{spell.notesIcon.iconClass}} spell-notes-icon" data-uuid="{{spell.notesIcon.uuid}}"
              data-action="editNotes" data-tooltip="{{spell.notesIcon.tooltip}}"
              aria-label="{{spell.notesIcon.tooltip}}"></i>
          {{/if}}

          {{!-- Formatted Details --}}
          {{#if spell.formattedDetails}}
            {{{spell.formattedDetails}}}
          {{/if}}
        </span>
      {{/if}}
    </div>
  </div>

  {{!-- Wizard Spell Learning Actions --}}
  <div class="wizard-spell-status">
    {{#if spell.wizardAction.isFromScroll}}
      {{!-- Learn from Scroll Button --}}
      <button class="copy-spell-btn scroll-spell-btn" data-action="learnFromScroll"
        data-uuid="{{spell.wizardAction.uuid}}" data-scroll-id="{{spell.wizardAction.scrollId}}" type="button"
        aria-label="{{spell.wizardAction.ariaLabel}}">
        <i class="fas fa-scroll"></i> {{localize "SPELLBOOK.Wizard.LearnSpell"}}
      </button>
{{else if spell.wizardAction.inSpellbook}}
      {{!-- Already in Spellbook Status with Learning Source --}}
      <span
        class="in-spellbook-tag{{#if spell.wizardAction.learningSource}} learned-{{spell.wizardAction.learningSource}}{{/if}}"
        aria-label="{{localize 'SPELLBOOK.Wizard.InSpellbook'}}">
        {{!-- Learning Source Icon --}}
        {{#if spell.wizardAction.learningSource}}
          {{#if (eq spell.wizardAction.learningSource "scroll")}}
            <i class="fa-solid fa-scroll" aria-hidden="true"></i>
          {{else if (eq spell.wizardAction.learningSource "gold")}}
            <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i>
          {{else if (eq spell.wizardAction.learningSource "levelup")}}
            <i class="fa-solid fa-arrow-up" aria-hidden="true"></i>
          {{else}}
            <i class="fa-solid fa-book" aria-hidden="true"></i>
          {{/if}}
        {{else}}
          <i class="fa-solid fa-book" aria-hidden="true"></i>
        {{/if}}
        {{!-- Learning Source Label --}}
        {{#if spell.wizardAction.learningSourceLabel}}
          {{spell.wizardAction.learningSourceLabel}}
        {{else}}
          {{localize "SPELLBOOK.Wizard.InSpellbook"}}
        {{/if}}
      </span>
    {{else if spell.wizardAction.canLearn}}
      {{!-- Learn Spell Button (Standard) --}}
      <button class="copy-spell-btn" data-action="learnSpell" data-uuid="{{spell.wizardAction.uuid}}" type="button"
        aria-label="{{localize 'SPELLBOOK.Wizard.LearnSpell'}}">
        <i class="fas fa-book"></i> {{localize "SPELLBOOK.Wizard.LearnSpell"}}
      </button>
    {{/if}}
  </div>
</li>
