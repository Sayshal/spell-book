{{!--
/**
 * Spell Item Component Template
 *
 * PURPOSE:
 * Individual spell item component for displaying spell details with preparation
 * controls, action buttons, and metadata. Handles both regular spellcasting
 * and wizard spellbook contexts with appropriate actions and styling.
 *
 * CONTEXT REQUIREMENTS:
 * @param {ProcessedSpell} spell - Processed spell data for display
 *
 * ACCESSIBILITY FEATURES:
 * - Button elements with proper aria-label attributes
 * - Tooltip data attributes for additional context
 * - Semantic list item structure for screen readers
 * - Action buttons with descriptive labels
 *
 * INTEGRATION:
 * - Used within spell-level component via partial-block pattern
 * - Supports both player spell book and wizard spellbook contexts
 * - Integrates with spell preparation, favorites, and notes systems
 */
--}}

<li class="{{spell.cssClasses}}" {{{spell.dataAttributes}}}>
  <div class="spell-name">
    {{{spell.enrichedIcon}}}
    <div class="name-stacked">
      <span class="title">
        {{spell.name}}

        {{!-- Favorite Star Button --}}
        {{#if spell.favoriteButton.enabled}}
          <button type="button" class="spell-favorite-toggle {{#if spell.favoriteButton.favorited}}favorited{{/if}}"
            data-action="toggleFavorite" data-uuid="{{spell.favoriteButton.uuid}}"
            data-tooltip="{{spell.favoriteButton.tooltip}}" aria-label="{{spell.favoriteButton.tooltip}}">
            <i class="{{spell.favoriteButton.iconClass}} fa-star" aria-hidden="true"></i>
          </button>
        {{/if}}

        {{!-- Spell Tag --}}
        {{#if spell.tag}}
          <span class="tag {{spell.tag.cssClass}}" {{#if spell.tag.tooltip}}data-tooltip="{{spell.tag.tooltip}}"
            {{/if}}>
            {{spell.tag.text}}
          </span>
        {{/if}}

        {{!-- Party Member Icons --}}
        {{#if spell.partyIcons.enabled}}
          <span class="party-icons">
            {{#each spell.partyIcons.icons as |icon|}}
              <img src="{{icon.src}}" class="party-member-icon" data-tooltip="{{icon.name}}"
                data-actor-id="{{icon.actorId}}" style="box-shadow: 0 0 0.1rem 0.1rem {{icon.userColor}};">
            {{/each}}
          </span>
        {{/if}}
      </span>

      {{!-- Subtitle with Icons and Metadata --}}
      {{#if (or spell.comparisonIcon.enabled spell.notesIcon.enabled spell.formattedDetails)}}
        <span class="subtitle" {{#if spell.materialComponentsTooltip}}data-tooltip="{{spell.materialComponentsTooltip}}"
          {{/if}}>
          {{!-- Comparison Icon --}}
          {{#if spell.comparisonIcon.enabled}}
            <i class="fa-solid fa-clipboard-question spell-compare-icon{{#if spell.comparisonIcon.active}} active{{/if}}"
              data-action="compareSpell" data-uuid="{{spell.comparisonIcon.uuid}}"
              data-tooltip="{{spell.comparisonIcon.tooltip}}" aria-label="{{spell.comparisonIcon.ariaLabel}}"></i>
          {{/if}}

          {{!-- Notes Icon --}}
          {{#if spell.notesIcon.enabled}}
            <i class="{{spell.notesIcon.iconClass}} spell-notes-icon" data-uuid="{{spell.notesIcon.uuid}}"
              data-action="editNotes" data-tooltip="{{spell.notesIcon.tooltip}}"
              aria-label="{{spell.notesIcon.tooltip}}"></i>
          {{/if}}

          {{!-- Formatted Details --}}
          {{#if spell.formattedDetails}}
            {{{spell.formattedDetails}}}
          {{/if}}
        </span>
      {{/if}}
    </div>
  </div>

  {{!-- Spell Actions --}}
  {{#if (or isWizardContext (isWizardTab @root.activeTab))}}
    {{!-- Wizard Tab Actions --}}
    <div class="wizard-spell-status">
      {{#if spell.wizardAction.isFromScroll}}
        <button class="copy-spell-btn scroll-spell-btn" data-action="learnFromScroll"
          data-uuid="{{spell.wizardAction.uuid}}" data-scroll-id="{{spell.wizardAction.scrollId}}" type="button"
          aria-label="{{spell.wizardAction.ariaLabel}}">
          <i class="fas fa-scroll"></i> {{localize "SPELLBOOK.Wizard.LearnSpell"}}
        </button>
      {{else if spell.wizardAction.inSpellbook}}
        <span
          class="in-spellbook-tag{{#if spell.wizardAction.learningSource}} learned-{{spell.wizardAction.learningSource}}{{/if}}"
          aria-label="{{localize 'SPELLBOOK.Wizard.InSpellbook'}}">
          {{#if spell.wizardAction.learningSourceLabel}}
            {{spell.wizardAction.learningSourceLabel}}
          {{else}}
            {{localize "SPELLBOOK.Wizard.InSpellbook"}}
          {{/if}}
        </span>
      {{else if spell.wizardAction.canLearn}}
        <button class="copy-spell-btn" data-action="learnSpell" data-uuid="{{spell.wizardAction.uuid}}" type="button">
          <i class="fas fa-book"></i> {{localize "SPELLBOOK.Wizard.LearnSpell"}}
        </button>
      {{/if}}
    </div>
  {{else}}
    {{!-- Regular Spell Preparation --}}
    <div class="spell-preparation dnd5e2">
      {{{spell.preparationCheckboxHtml}}}
    </div>
  {{/if}}
</li>
