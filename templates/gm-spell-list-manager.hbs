<div class="gm-spell-list-manager-container">
	{{#if isLoading}}
		<div class="manager-loading">
			<i class="fas fa-spinner fa-spin fa-3x"></i>
			<p>Loading spell lists...</p>
		</div>
	{{else if hasError}}
		<div class="manager-error">
			<p class="error-message">{{errorMessage}}</p>
		</div>
	{{else}}
		<!-- Left Sidebar: Available spell lists -->
		<div class="spell-lists-sidebar card">
			<!-- Collapser Button -->
			<button type="button" class="sidebar-collapser collapser vertical" data-action="toggleSidebar"
				aria-label="Toggle Sidebar">
				<i class="fas fa-caret-left"></i>
			</button>

			<h2>Available Spell Lists</h2>
			<div class="lists-container">
				{{#if availableSpellLists.length}}
					<ul class="spell-list-items">
						{{#each availableSpellLists as |list|}}
							<li class="spell-list-item" data-uuid="{{list.uuid}}">
								<div class="list-item-header" data-action="selectSpellList" data-uuid="{{list.uuid}}">
									<div class="list-name">
										<i class="fas fa-book"></i>
										<span>{{list.name}}</span>
									</div>
									<div class="list-meta">
										<span class="spell-count">{{list.spellCount}} Spells</span>
										<span class="meta-separator">â€¢</span>
										<span class="source">{{list.pack}}</span>
									</div>
								</div>
							</li>
						{{/each}}
					</ul>
				{{else}}
					<p class="no-lists">No spell lists found.</p>
				{{/if}}
			</div>
		</div>

		<!-- Middle Content: Selected spell list -->
		<section class="selected-list-content">
			{{#if selectedSpellList}}
				<div class="selected-list-header">
					<h2>{{selectedSpellList.name}}</h2>
					{{#unless isEditing}}
						<button type="button" class="edit-button" data-action="editSpellList"
							data-uuid="{{selectedSpellList.uuid}}">
							<i class="fas fa-edit"></i> Edit
						</button>
					{{else}}
						{{#if isCustomList}}
							<div class="custom-list-controls">
								{{#if compareInfo.hasOriginalChanged}}
									<span class="update-notice">Original has been updated</span>
								{{/if}}
								<button type="button" class="restore-button" data-action="restoreOriginal"
									data-uuid="{{selectedSpellList.uuid}}">
									<i class="fas fa-sync"></i> Restore from Source
								</button>
								<button type="button" class="delete-button" data-action="deleteCustomList"
									data-uuid="{{selectedSpellList.uuid}}">
									<i class="fas fa-trash"></i> Delete Custom Version
								</button>
							</div>
						{{/if}}
						<button type="button" class="save-button" data-action="saveCustomList"
							data-uuid="{{selectedSpellList.uuid}}">
							<i class="fas fa-save"></i> Save
						</button>
					{{/unless}}
				</div>
				<div class="selected-list-spells">
					{{#if selectedSpellList.isLoadingSpells}}
						<div class="spell-loading">
							<i class="fas fa-spinner fa-spin fa-2x"></i>
							<p>Loading spells...</p>
						</div>
					{{else if selectedSpellList.hasError}}
						<p class="spell-error">Error loading spells.</p>
					{{else if selectedSpellList.spells.length}}
						<ul class="selected-spells">
							{{#each selectedSpellList.spells as |spell|}}
								<li class="spell-item" data-uuid="{{spell.uuid}}">
									<div class="spell-name">
										<img src="{{spell.img}}" class="spell-icon" alt="{{spell.name}} icon">
										<span class="name">{{spell.name}}</span>
									</div>
									<div class="spell-meta">
										<span class="spell-level">{{lookup @root.spellLevels spell.level}}</span>
										<span class="spell-school">{{lookup (lookup @root.spellSchools spell.school) 'label'}}</span>
										{{#if @root.isEditing}}
											<button type="button" class="remove-spell" data-action="removeSpell" data-uuid="{{spell.uuid}}">
												<i class="fas fa-times"></i>
											</button>
										{{/if}}
									</div>
								</li>
							{{/each}}
						</ul>
					{{else}}
						<p class="no-spells">{{#if isEditing}}Add spells from the right panel.{{else}}No spells in this
								list.{{/if}}</p>
					{{/if}}
				</div>
			{{else}}
				<div class="no-selection">
					<p>Select a spell list from the left sidebar to view its contents.</p>
				</div>
			{{/if}}
		</section>

		<!-- Right Sidebar: Available spells -->
		<div class="available-spells-sidebar">
			<h2>Available Spells</h2>
			<div class="spell-filters">
				<input type="text" name="spell-search" placeholder="Search spells..." value="{{filterState.name}}">
				<select name="spell-level">
					<option value="">All Levels</option>
					{{#each spellLevels as |label level|}}
						<option value="{{level}}" {{#if (eq ../filterState.level level)}}selected{{/if}}>{{label}}</option>
					{{/each}}
				</select>
				<select name="spell-school">
					<option value="">All Schools</option>
					{{#each spellSchools as |school key|}}
						<option value="{{key}}" {{#if (eq ../filterState.school key)}}selected{{/if}}>{{school.label}}</option>
					{{/each}}
				</select>
			</div>
			<div class="available-spells-list">
				{{#if isEditing}}
					{{#if filteredSpells.spells.length}}
						<ul class="available-spells">
							{{#each filteredSpells.spells as |spell|}}
								<li class="spell-item available" data-uuid="{{spell.uuid}}">
									<div class="spell-name">
										<img src="{{spell.img}}" class="spell-icon" alt="{{spell.name}} icon">
										<span class="name">{{spell.name}}</span>
									</div>
									<div class="spell-meta">
										<span class="spell-level">{{lookup @root.spellLevels spell.level}}</span>
										<span class="spell-school">{{lookup (lookup @root.spellSchools spell.school) 'label'}}</span>
										<button type="button" class="add-spell" data-action="addSpell" data-uuid="{{spell.uuid}}">
											<i class="fas fa-plus"></i>
										</button>
									</div>
								</li>
							{{/each}}
						</ul>

						{{#if filteredSpells.totalItems}}
							<div class="pagination-controls">
								<div class="pagination-status">
									Showing
									{{add (multiply paginationState.currentPage paginationState.pageSize) 1}}-{{min (add (multiply paginationState.currentPage paginationState.pageSize) paginationState.pageSize) filteredSpells.totalFiltered}}
									of {{filteredSpells.totalFiltered}} spells
								</div>
								<div class="pagination-buttons">
									<button type="button" class="pagination-button" data-action="pageNavigation"
										data-page-action="first-page" {{#if (eq paginationState.currentPage 0)}}disabled{{/if}}>
										<i class="fas fa-angle-double-left"></i>
									</button>
									<button type="button" class="pagination-button" data-action="pageNavigation"
										data-page-action="prev-page" {{#if (eq paginationState.currentPage 0)}}disabled{{/if}}>
										<i class="fas fa-angle-left"></i>
									</button>

									{{#if (gt paginationState.totalPages 1)}}
										<span class="pagination-pages">
											Page {{add paginationState.currentPage 1}} of {{paginationState.totalPages}}
										</span>
									{{/if}}

									<button type="button" class="pagination-button" data-action="pageNavigation"
										data-page-action="next-page"
										{{#if (eq paginationState.currentPage (subtract paginationState.totalPages 1))}}disabled{{/if}}>
										<i class="fas fa-angle-right"></i>
									</button>
									<button type="button" class="pagination-button" data-action="pageNavigation"
										data-page-action="last-page"
										{{#if (eq paginationState.currentPage (subtract paginationState.totalPages 1))}}disabled{{/if}}>
										<i class="fas fa-angle-double-right"></i>
									</button>
								</div>
							</div>
						{{/if}}
					{{else}}
						<p class="no-spells">No spells match your filters or all matching spells are already in the list.</p>
					{{/if}}
				{{else}}
					<p class="phase-notice">Select a spell list and click "Edit" to customize it.</p>
				{{/if}}
			</div>
		</div>

		<!-- Footer with actions -->
		<div class="manager-footer">
			<button type="button" class="help-button" data-action="showDocumentation">
				<i class="fas fa-question-circle"></i> Help
			</button>
			<button type="button" class="close-button" data-action="closeSpellManager">
				<i class="fas fa-times"></i> Close
			</button>
		</div>
	{{/if}}
</div>
