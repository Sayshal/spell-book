<div class="gm-spell-list-manager-container">
	{{#if isLoading}}
		<div class="manager-loading">
			<i class="fas fa-spinner fa-spin fa-3x"></i>
			<p>Loading spell lists...</p>
		</div>
	{{else if hasError}}
		<div class="manager-error">
			<p class="error-message">{{errorMessage}}</p>
		</div>
	{{else}}
		<!-- Three-column layout -->
		<div class="manager-columns">
			<!-- Column 1: Available spell lists -->
			<div class="spell-lists-column">
				<h2>Available Spell Lists</h2>
				<div class="list-container">
					{{#if availableSpellLists.length}}
						<ul class="spell-list-items">
							{{#each availableSpellLists as |list|}}
								<li class="spell-list-item" data-uuid="{{list.uuid}}">
									<div class="list-item-header" data-action="selectSpellList" data-uuid="{{list.uuid}}">
										<div class="list-name">
											<i class="fas fa-book"></i>
											<span>{{list.name}}</span>
										</div>
										<div class="list-meta">
											<span class="spell-count">{{list.spellCount}} spells</span>
											<span class="source">{{list.pack}}</span>
										</div>
									</div>
								</li>
							{{/each}}
						</ul>
					{{else}}
						<p class="no-lists">No spell lists found.</p>
					{{/if}}
				</div>
			</div>

			<!-- Column 2: Selected spell list content -->
			<div class="selected-list-column">
				{{#if selectedSpellList}}
					<div class="selected-list-header">
						<h2>{{selectedSpellList.name}}</h2>
						{{#unless isEditing}}
							<button type="button" class="edit-button" data-action="editSpellList"
								data-uuid="{{selectedSpellList.uuid}}">
								<i class="fas fa-edit"></i> Edit
							</button>
						{{else}}
							{{#if isCustomList}}
								<div class="custom-list-controls">
									{{#if compareInfo.hasOriginalChanged}}
										<span class="update-notice">Original has been updated</span>
									{{/if}}
									<button type="button" class="restore-button" data-action="restoreOriginal"
										data-uuid="{{selectedSpellList.uuid}}">
										<i class="fas fa-sync"></i> Restore from Source
									</button>
									<button type="button" class="delete-button" data-action="deleteCustomList"
										data-uuid="{{selectedSpellList.uuid}}">
										<i class="fas fa-trash"></i> Delete Custom Version
									</button>
								</div>
							{{/if}}
							<button type="button" class="save-button" data-action="saveCustomList"
								data-uuid="{{selectedSpellList.uuid}}">
								<i class="fas fa-save"></i> Save
							</button>
						{{/unless}}
					</div>
					<div class="selected-list-content">
						{{#if selectedSpellList.isLoadingSpells}}
							<div class="spell-loading">
								<i class="fas fa-spinner fa-spin fa-2x"></i>
								<p>Loading spells...</p>
							</div>
						{{else if selectedSpellList.hasError}}
							<p class="spell-error">Error loading spells.</p>
						{{else if selectedSpellList.spells.length}}
							<ul class="selected-spells">
								{{#each selectedSpellList.spells as |spell|}}
									<li class="spell-item" data-uuid="{{spell.uuid}}">
										<div class="spell-name">
											<img src="{{spell.img}}" class="spell-icon" alt="{{spell.name}} icon">
											<span class="name">{{spell.name}}</span>
										</div>
										<div class="spell-meta">
											<span class="spell-level">{{lookup @root.spellLevels spell.level}}</span>
											<span class="spell-school">{{lookup (lookup @root.spellSchools spell.school) 'label'}}</span>
											{{#if @root.isEditing}}
												<button type="button" class="remove-spell" data-action="removeSpell" data-uuid="{{spell.uuid}}">
													<i class="fas fa-times"></i>
												</button>
											{{/if}}
										</div>
									</li>
								{{/each}}
							</ul>
						{{else}}
							<p class="no-spells">{{#if isEditing}}Add spells from the right panel.{{else}}No spells in this
									list.{{/if}}</p>
						{{/if}}
					</div>
				{{else}}
					<div class="no-selection">
						<p>Select a spell list from the left column to view its contents.</p>
					</div>
				{{/if}}
			</div>

			<!-- Column 3: Available spells for adding -->
			<div class="available-spells-column">
				<h2>Available Spells</h2>
				<div class="spell-filters">
					<input type="text" name="spell-search" placeholder="Search spells..." value="{{filterState.name}}">
					<select name="spell-level">
						<option value="">All Levels</option>
						{{#each spellLevels as |label level|}}
							<option value="{{level}}" {{#if (eq ../filterState.level level)}}selected{{/if}}>{{label}}</option>
						{{/each}}
					</select>
					<select name="spell-school">
						<option value="">All Schools</option>
						{{#each spellSchools as |school key|}}
							<option value="{{key}}" {{#if (eq ../filterState.school key)}}selected{{/if}}>{{school.label}}</option>
						{{/each}}
					</select>
				</div>
				<div class="available-spells-list">
					{{#if isEditing}}
						{{#if filteredSpells.length}}
							<ul class="spell-list-items">
								{{#each filteredSpells as |spell|}}
									<li class="spell-item available" data-uuid="{{spell.uuid}}">
										<div class="spell-name">
											<img src="{{spell.img}}" class="spell-icon" alt="{{spell.name}} icon">
											<span class="name">{{spell.name}}</span>
										</div>
										<div class="spell-meta">
											<span class="spell-level">{{lookup @root.spellLevels spell.level}}</span>
											<span class="spell-school">{{lookup (lookup @root.spellSchools spell.school) 'label'}}</span>
											<button type="button" class="add-spell" data-action="addSpell" data-uuid="{{spell.uuid}}">
												<i class="fas fa-plus"></i>
											</button>
										</div>
									</li>
								{{/each}}
							</ul>
						{{else}}
							<p class="no-spells">No spells match your filters or all matching spells are already in the list.</p>
						{{/if}}
					{{else}}
						<p class="phase-notice">Select a spell list and click "Edit" to customize it.</p>
					{{/if}}
				</div>
			</div>
		</div>

		<!-- Footer with actions -->
		<div class="manager-footer">
			<button type="button" class="close-button" data-action="closeSpellManager">
				<i class="fas fa-times"></i> Close
			</button>
		</div>
	{{/if}}
</div>
