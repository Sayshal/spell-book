<div class="spellstab tab {{#if (eq activeTab 'spellstab')}}active{{/if}}" data-tab="spellstab" data-group="spellbook-tabs">
	<div class="spells-container">
		{{#if isLoading}}
			{{> "modules/spell-book/templates/components/loading-spinner.hbs" size=3 message=(localize 'SPELLBOOK.Application.Loading')}}
		{{else if hasError}}
			{{> "modules/spell-book/templates/components/error-message.hbs" message=errorMessage}}
		{{else}}
			{{#if spellLevels.length}}
				{{#each spellLevels as |levelData|}}
					{{#> "modules/spell-book/templates/components/spell-level.hbs" level=levelData.level levelName=levelData.levelName spells=levelData.spells}}
						<li
							class="spell-item{{#if preparation.isOwned}} owned-spell{{/if}}{{#if preparation.prepared}} prepared-spell{{/if}}{{#if inWizardSpellbook}} in-wizard-spellbook{{/if}}"
							data-spell-uuid="{{compendiumUuid}}" data-spell-level="{{../level}}" data-spell-school="{{system.school}}"
							data-casting-time-type="{{filterData.castingTime.type}}"
							data-casting-time-value="{{filterData.castingTime.value}}" data-range-units="{{filterData.range.units}}"
							data-range-value="{{system.range.value}}" data-damage-types="{{filterData.damageTypes}}"
							data-ritual="{{filterData.isRitual}}" data-concentration="{{filterData.concentration}}"
							data-requires-save="{{filterData.requiresSave}}" data-conditions="{{filterData.conditions}}"
							role="listitem">
							<div class="spell-name">
								{{!-- {{log 'DEBUG' name preparation}} --}}
								{{{enrichedIcon}}}
								<div class="name-stacked">
									<span class="title">{{name}}
										{{#if preparation.alwaysPrepared}}
											<span class="tag always-prepared"
												data-tooltip="{{#if preparation.sourceItem.name}}{{preparation.sourceItem.name}}{{else}}{{localize 'SPELLBOOK.Preparation.AlwaysTooltip'}}{{/if}}">
												{{localize 'SPELLBOOK.Preparation.Always'}}
											</span>
										{{else if preparation.isGranted}}
											<span class="tag granted"
												data-tooltip="{{#if preparation.sourceItem.name}}{{preparation.sourceItem.name}}{{/if}}">
												{{localize 'SPELLBOOK.SpellSource.Granted'}}
											</span>
										{{else if (eq preparation.preparationMode 'pact')}}
											<span class="tag pact"
												data-tooltip="{{#if preparation.sourceItem.name}}{{preparation.sourceItem.name}}{{/if}}">
												{{preparation.localizedPreparationMode}}
											</span>
										{{else if (eq preparation.preparationMode 'innate')}}
											<span class="tag innate"
												data-tooltip="{{#if preparation.sourceItem.name}}{{preparation.sourceItem.name}}{{/if}}">
												{{preparation.localizedPreparationMode}}
											</span>
										{{else if (eq preparation.preparationMode 'ritual')}}
											<span class="tag ritual"
												data-tooltip="{{#if preparation.sourceItem.name}}{{preparation.sourceItem.name}}{{/if}}">
												{{preparation.localizedPreparationMode}}
											</span>
										{{else if (eq preparation.preparationMode 'atwill')}}
											<span class="tag atwill"
												data-tooltip="{{#if preparation.sourceItem.name}}{{preparation.sourceItem.name}}{{/if}}">
												{{preparation.localizedPreparationMode}}
											</span>
										{{else if (and (eq preparation.preparationMode 'prepared') preparation.prepared)}}
											<span class="tag prepared">
												{{localize 'SPELLBOOK.Preparation.Prepared'}}
											</span>
										{{/if}}
									</span>
									<span class="subtitle">{{{formattedDetails}}}</span>
								</div>

								<div class="spell-preparation dnd5e2">
									{{{preparationCheckboxHtml}}}
								</div>
						</li>
						{{/modules/spell-book/templates/components/spell-level.hbs}}
				{{/each}}
			{{else}}
				{{> "modules/spell-book/templates/components/empty-state.hbs" message=(localize 'SPELLBOOK.Errors.NoSpellsFound' actor=actor.name)}}
			{{/if}}
		{{/if}}

		<!-- No results message (initially hidden) -->
		<div class="no-filter-results" style="display: none;" role="status">
			{{localize 'SPELLBOOK.Filters.NoResults'}}
		</div>
	</div>
</div>
