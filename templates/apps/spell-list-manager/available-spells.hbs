<div class="available-spells-sidebar" role="complementary"
	aria-label="{{localize 'SPELLMANAGER.Columns.AvailableSpells'}}">

	<!-- Available Spells Header -->
	<h2 id="available-spells-heading">{{localize "SPELLMANAGER.Columns.AvailableSpells"}}</h2>

	<!-- Spell Filtering Section - search and filter controls -->
	<div class="spell-filters" role="search" aria-labelledby="available-spells-heading">
		<!-- Search Input Container -->
		<div class="filter-search">
			{{{filterFormElements.searchInputHtml}}}
		</div>

		<!-- Filter Grid - Organized filter controls for spell attributes -->
		<div class="filter-grid">
			<!-- Spell Level Filter -->
			<div class="filter-item">
				<label for="spell-level">{{localize "SPELLBOOK.Filters.Level"}}</label>
				{{{filterFormElements.levelSelectHtml}}}
			</div>

			<!-- Spell School Filter -->
			<div class="filter-item">
				<label for="spell-school">{{localize "SPELLBOOK.Filters.School"}}</label>
				{{{filterFormElements.schoolSelectHtml}}}
			</div>

			<!-- Casting Time Filter -->
			<div class="filter-item">
				<label for="spell-castingTime">{{localize "SPELLBOOK.Filters.CastingTime"}}</label>
				{{{filterFormElements.castingTimeSelectHtml}}}
			</div>

			<!-- Damage Type Filter -->
			<div class="filter-item">
				<label for="spell-damageType">{{localize "SPELLBOOK.Filters.DamageType"}}</label>
				{{{filterFormElements.damageTypeSelectHtml}}}
			</div>

			<!-- Condition Effect Filter -->
			<div class="filter-item">
				<label for="spell-condition">{{localize "SPELLBOOK.Filters.Condition"}}</label>
				{{{filterFormElements.conditionSelectHtml}}}
			</div>

			<!-- Saving Throw Requirement Filter -->
			<div class="filter-item">
				<label for="spell-requiresSave">{{localize "SPELLBOOK.Filters.RequiresSave"}}</label>
				{{{filterFormElements.requiresSaveSelectHtml}}}
			</div>

			<!-- Concentration Requirement Filter -->
			<div class="filter-item">
				<label for="spell-concentration">{{localize "SPELLBOOK.Filters.RequiresConcentration"}}</label>
				{{{filterFormElements.concentrationSelectHtml}}}
			</div>

			<!-- Material Components Filter -->
			<div class="filter-item">
				<label for="spell-materialComponents">{{localize "SPELLBOOK.Filters.Materials.Title"}}</label>
				{{{filterFormElements.materialComponentsSelectHtml}}}
			</div>

			<!-- Ritual Spell Checkbox Filter -->
			<div class="filter-item checkbox-filter">
				<label>
					{{{filterFormElements.ritualCheckboxHtml}}}
					{{localize "SPELLBOOK.Filters.RitualOnly"}}
				</label>
			</div>
		</div>

		<!-- Range Filter Section - Min/max range inputs with unit display -->
		<div class="filter-range">
			<label id="range-filter-label">{{localize "SPELLBOOK.Filters.Range"}}
				({{#if @root.settings.useMetricUnits}}{{localize "DND5E.DistM"}}{{else}}{{localize "DND5E.DistFt"}}{{/if}})</label>
			<div class="range-inputs" role="group" aria-labelledby="range-filter-label">
				{{{filterFormElements.minRangeInputHtml}}}
				<div class="range-separator" aria-hidden="true">
					<dnd5e-icon src="systems/dnd5e/icons/svg/range-connector.svg"></dnd5e-icon>
				</div>
				{{{filterFormElements.maxRangeInputHtml}}}
			</div>
		</div>

		<!-- Source Filters Section - Combined compendium and spell source filters -->
		<div class="filter-source">
			<div class="source-filters" role="group">
				<div class="filter-item">
					<label for="spell-compendium-source">{{localize "SPELLMANAGER.Filters.CompendiumSource"}}</label>
					{{{filterFormElements.compendiumSourceSelectHtml}}}
				</div>
				<div class="filter-item">
					<label for="spell-source">{{localize "SPELLMANAGER.Filters.SpellSource"}}</label>
					{{{filterFormElements.sourceSelectHtml}}}
				</div>
			</div>
		</div>

		<!-- Bulk Selection Controls - Available during editing with selection mode -->
		{{#if (and isEditing selectionMode)}}
			<div class="select-all-add-container">
				<span class="selection-label">{{localize "SPELLMANAGER.Selection.SelectAllToAdd"}}</span>
				{{{selectAllAddCheckboxHtml}}}
			</div>
		{{/if}}

		<!-- Available Spells List Container -->
		<div class="available-spells-list">
			{{#if isEditing}}
				{{#if filteredSpells.spells.length}}
					<!-- Filtered Spells Display -->
					<div class="available-spells-wrapper">
						<ul class="available-spells" role="list" aria-label="{{localize 'SPELLMANAGER.UI.FilteredSpells'}}">
							{{#each filteredSpells.spells as |spell|}}
								<!-- Individual Spell Item with data attributes for filtering -->
								<li
									class="spell-item available{{#if ../selectionMode}} selectable{{/if}}{{#if (lookup ../selectedSpellsToAdd spell.uuid)}} selected{{/if}}"
									data-uuid="{{spell.uuid}}" data-spell-level="{{spell.level}}" data-spell-school="{{spell.school}}"
									data-casting-time-type="{{spell.filterData.castingTime.type}}"
									data-casting-time-value="{{spell.filterData.castingTime.value}}"
									data-range-units="{{spell.filterData.range.units}}" data-range-value="{{spell.system.range.value}}"
									data-damage-types="{{spell.filterData.damageTypes}}" data-ritual="{{spell.filterData.isRitual}}"
									data-concentration="{{spell.filterData.concentration}}"
									data-requires-save="{{spell.filterData.requiresSave}}"
									data-conditions="{{spell.filterData.conditions}}"
									data-spell-source="{{spell.filterData.spellSourceId}}" data-selection-type="add" role="listitem">

									<!-- Spell Name and Details Section -->
									<div class="spell-name">
										{{{spell.enrichedIcon}}}
										<div class="name-stacked">
											<span class="title">{{spell.name}}</span>
											<span class="subtitle">{{#if spell.showCompareLink}}{{#if spell.showCompare}}<button
															class="compare-button compare-link{{#if spell.isInComparison}} active{{/if}}"
															data-action="compareSpell" data-uuid="{{spell.uuid}}"
															aria-label="{{localize 'SPELLBOOK.Comparison.CompareSpell' name=spell.name}}"
															data-tooltip="{{localize "SPELLBOOK.Comparison.Compare"}}">
															<i class="fa-solid fa-clipboard-question"></i>
														</button> {{/if}}{{/if}}{{spell.formattedDetails}}</span>
										</div>
									</div>

									<!-- Spell Action Controls - Selection or addition buttons -->
									<div class="spell-meta">
										{{#if ../selectionMode}}
											<!-- Bulk Selection Checkbox -->
											{{{spell.selectAddCheckboxHtml}}}
										{{else}}
											<!-- Individual Add Button -->
											<button type="button" class="add-spell" data-action="addSpell" data-uuid="{{spell.uuid}}"
												aria-label="{{localize 'SPELLMANAGER.Buttons.AddSpell' name=spell.name}}">
												<i class="fas fa-plus" aria-hidden="true"></i>
											</button>
										{{/if}}
									</div>
								</li>
							{{/each}}
						</ul>
					</div>
				{{else}}
					<!-- No Matching Spells State -->
					{{> "modules/spell-book/templates/components/empty-state.hbs" message=(localize "SPELLMANAGER.Columns.NoMatchingSpells")}}
				{{/if}}
			{{else}}
				<!-- Not Editing State - Prompt to start editing -->
				<p class="phase-notice">{{localize "SPELLMANAGER.Columns.EditPrompt"}}</p>
			{{/if}}
		</div>
	</div>
