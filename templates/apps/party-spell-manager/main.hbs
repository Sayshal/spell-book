<div class="party-spell-manager-content">
  <div class="party-title-section">
    <h2 class="party-name">{{groupName}} {{localize "SPELLBOOK.Party.SpellPool"}}</h2>
    <h4 class="member-count">{{comparison.actors.length}} {{localize "SPELLBOOK.Party.Members"}}</h4>
    <div class="party-actions">
      <button type="button" class="refresh-button" data-action="refreshData"
        data-tooltip="{{localize 'SPELLBOOK.Party.RefreshData'}}">
        <i class="fas fa-sync" aria-hidden="true"></i>
        {{localize "SPELLBOOK.Party.Refresh"}}
      </button>
      <button type="button" class="analysis-button" data-action="showSynergyAnalysis"
        data-tooltip="{{localize 'SPELLBOOK.Party.ShowSynergyAnalysis'}}">
        <i class="fas fa-chart-line" aria-hidden="true"></i>
        {{localize "SPELLBOOK.Party.SynergyAnalysis"}}
      </button>
    </div>
  </div>

  <section class="party-members">
    <div class="members-grid">
      {{#each comparison.actors as |actor|}}
        <div class="member-card {{#unless actor.hasPermission}}no-permission{{/unless}}" data-actor-id="{{actor.id}}">
          <div class="member-header">
            <div class="member-info-top">
              <img src="{{actor.token}}" class="member-avatar" alt="{{actor.name}}">
              <div class="member-name-class">
                <span class="member-name">{{actor.name}}</span>
                {{#if actor.hasPermission}}
                  <div class="member-class-info">
                    {{#each actor.spellcasters as |class|}}
                      <span class="class-name">{{class.enhancedClassName}}</span>{{#unless @last}}, {{/unless}}
                    {{/each}}
                  </div>
                {{else}}
                  <span class="no-permission-text">{{localize "SPELLBOOK.Party.NoViewPermission"}}</span>
                {{/if}}
              </div>
              {{#if actor.hasPermission}}
                <div class="spell-counts-compact">
                  <span class="count-item">
                    <span class="count-number">{{actor.totalSpellsKnown}}</span>
                    <span class="count-label">{{localize "SPELLBOOK.Party.Known"}}</span>
                  </span>
                  <span class="count-item">
                    <span class="count-number">{{actor.totalSpellsPrepared}}</span>
                    <span class="count-label">{{localize "SPELLBOOK.Party.Prepared"}}</span>
                  </span>
                </div>
              {{/if}}
            </div>
            <!-- TODO: Create a settings menu within the UI to set an icon and title and description for each Spellcasting Focus Options instead of a global setting. Future logic will allow clicking the icon to open the change-focus ui and hovering will show the name and description to view. -->
            <i class="fas fa-cog member-focus-icon" data-actor-id="{{actor.id}}"
              data-tooltip="{{localize 'SPELLBOOK.Party.FocusSettings'}}"></i>
          </div>
        </div>
      {{/each}}
    </div>
  </section>

  <section class="spell-comparison">
    {{#if spellLevels}}
      {{#each spellLevels as |levelGroup|}}
        <div class="spell-level-group" data-spell-level="{{levelGroup.level}}">
          <h4 class="level-header" data-action="toggleSpellLevel" role="button" aria-expanded="true"
            aria-controls="spell-list-{{levelGroup.level}}">
            <i class="fas fa-caret-down collapse-indicator" aria-hidden="true"></i>
            <span class="level-name">{{levelGroup.levelName}}</span>
            <span class="spell-count">({{levelGroup.spells.length}} {{localize "SPELLBOOK.Party.Spells"}})</span>
          </h4>

          <div class="spells-grid" id="spell-list-{{levelGroup.level}}">
            {{#each levelGroup.spells as |spell|}}
              <div class="spell-comparison-item" data-spell-uuid="{{spell.uuid}}">
                {{{spell.enrichedIcon}}}
                <span class="spell-name">{{spell.name}}</span>
                <div class="spell-actors">
                  {{#each spell.actorStatuses as |actorStatus|}}
                    <span class="actor-spell-status {{actorStatus.status}}"
                      data-actor-id="{{actorStatus.actorId}}">{{actorStatus.name}}</span>
                  {{/each}}
                </div>
              </div>
            {{/each}}
          </div>
        </div>
      {{/each}}
    {{/if}}
  </section>
</div>
