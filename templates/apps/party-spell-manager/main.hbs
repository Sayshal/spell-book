<div class="party-spell-manager-content">
  <div class="party-title-section">
    <h2 class="party-name">{{groupName}} {{localize "SPELLBOOK.Party.SpellPool"}}</h2>
    <h4 class="member-count">{{comparison.actors.length}} {{localize "SPELLBOOK.Party.Members"}}</h4>
    <div class="party-actions">
      <button type="button" class="refresh-button" data-action="refreshData"
        data-tooltip="{{localize 'SPELLBOOK.Party.RefreshData'}}">
        <i class="fas fa-sync" aria-hidden="true"></i>
        {{localize "SPELLBOOK.Party.Refresh"}}
      </button>
      <button type="button" class="analysis-button" data-action="showSynergyAnalysis"
        data-tooltip="{{localize 'SPELLBOOK.Party.ShowSynergyAnalysis'}}">
        <i class="fas fa-chart-line" aria-hidden="true"></i>
        {{localize "SPELLBOOK.Party.SynergyAnalysis"}}
      </button>
    </div>
  </div>

  <section class="party-members">
    <div class="members-grid">
      {{#each comparison.actors as |actor|}}
        <div class="member-card {{#unless actor.hasPermission}}no-permission{{/unless}}" data-actor-id="{{actor.id}}">
          <div class="member-header">
            <div class="member-info-top">
              <img src="{{actor.token}}" class="member-avatar" alt="{{actor.name}}">
              <div class="member-name-focus">
                <span class="member-name">{{actor.name}}</span>
                {{#if actor.hasPermission}}
                  <div class="member-class-info">
                    {{#each actor.spellcasters as |class|}}
                      <span class="class-name">{{class.className}}</span>{{#unless @last}}, {{/unless}}
                    {{/each}}
                  </div>
                {{/if}}
              </div>

              {{#if actor.hasPermission}}
                {{#if ../canEditFocus}}
                  <div class="focus-input-wrapper">
                    <select class="focus-input" data-actor-id="{{actor.id}}">
                      {{#each ../availableFocuses as |focus|}}
                        <option value="{{focus.value}}" {{#if (eq focus.value ../actor.focus)}}selected{{/if}}>
                          {{focus.label}}
                        </option>
                      {{/each}}
                    </select>
                  </div>
                {{else}}
                  <span class="focus-display">{{localize actor.focus}}</span>
                {{/if}}
              {{else}}
                <span class="no-permission-text">{{localize "SPELLBOOK.Party.NoViewPermission"}}</span>
              {{/if}}
            </div>
          </div>

          {{#if actor.hasPermission}}
            <div class="member-stats">
              <div class="spell-counts-summary">
                <div class="count-item">
                  <div class="count-number">{{actor.totalSpellsKnown}}</div>
                  <div class="count-label">{{localize "SPELLBOOK.Party.Known"}}</div>
                </div>
                <div class="count-item">
                  <div class="count-number">{{actor.totalSpellsPrepared}}</div>
                  <div class="count-label">{{localize "SPELLBOOK.Party.Prepared"}}</div>
                </div>
              </div>
            </div>
          {{/if}}
        </div>
      {{/each}}
    </div>
  </section>

  <section class="spell-comparison">
    {{#if spellLevels}}
      {{#each spellLevels as |levelGroup|}}
        <div class="spell-level-group" data-spell-level="{{levelGroup.level}}">
          <h4 class="level-header" data-action="toggleSpellLevel" role="button" aria-expanded="true"
            aria-controls="spell-list-{{levelGroup.level}}">
            <i class="fas fa-caret-down collapse-indicator" aria-hidden="true"></i>
            <span class="level-name">{{levelGroup.levelName}}</span>
            <span class="spell-count">({{levelGroup.spells.length}} {{localize "SPELLBOOK.Party.Spells"}})</span>
          </h4>

          <div class="spells-grid" id="spell-list-{{levelGroup.level}}">
            {{#each levelGroup.spells as |spell|}}
              <div class="spell-comparison-item" data-spell-uuid="{{spell.uuid}}">
                <div class="spell-header">
                  <div class="spell-icon-container">
                    {{{spell.enrichedIcon}}}
                  </div>
                  <div class="spell-title-info">
                    <span class="spell-name">{{spell.name}}</span>
                    <span class="spell-components">{{spell.components}}</span>
                  </div>
                </div>
                <div class="spell-actors">
                  {{#each spell.actorStatuses as |actorStatus|}}
                    <div class="actor-spell-status {{actorStatus.status}}" data-actor-id="{{actorStatus.actorId}}">
                      <span class="actor-name">{{actorStatus.name}}</span>
                    </div>
                  {{/each}}
                </div>
              </div>
            {{/each}}
          </div>
        </div>
      {{/each}}
    {{/if}}
  </section>
</div>
