<div class="party-spell-manager-content">
  <!-- Party Header Section - Group name, member count, and primary actions -->
  <div class="party-title-section">
    <h2 class="party-name">{{groupName}} {{localize "SPELLBOOK.Party.SpellPool"}}</h2>
    <h4 class="member-count">{{comparison.actors.length}} {{localize "SPELLBOOK.Party.Members"}}</h4>

    <!-- Primary Party Actions -->
    <div class="party-actions">
      <!-- Data Refresh Control -->
      <button type="button" class="refresh-button" data-action="refreshData"
        data-tooltip="{{localize 'SPELLBOOK.Party.RefreshData'}}">
        <i class="fas fa-sync" aria-hidden="true"></i>
        {{localize "SPELLBOOK.Party.Refresh"}}
      </button>

      <!-- Synergy Analysis Launcher -->
      <button type="button" class="analysis-button" data-action="showSynergyAnalysis"
        data-tooltip="{{localize 'SPELLBOOK.Party.ShowSynergyAnalysis'}}">
        <i class="fas fa-chart-line" aria-hidden="true"></i>
        {{localize "SPELLBOOK.Party.SynergyAnalysis"}}
      </button>
    </div>
  </div>

  <!-- Party Members Section - Cards displaying each party member's information -->
  <section class="party-members">
    <div class="members-grid">
      {{#each comparison.actors as |actor|}}
        <!-- Individual Member Card - Interactive element for filtering spells -->
        <div class="member-card {{#unless actor.hasPermission}}no-permission{{/unless}}" data-actor-id="{{actor.id}}"
          data-action="filterMemberSpells" data-tooltip="{{localize 'SPELLBOOK.Party.FilterToMember'}}">

          <div class="member-header">
            <!-- Member Basic Information - Avatar, name, class, spell counts -->
            <div class="member-info-top">
              <!-- Member Avatar -->
              <img src="{{actor.token}}" class="member-avatar" alt="{{actor.name}}">

              <!-- Member Name and Class Information -->
              <div class="member-name-class">
                <span class="member-name">{{actor.name}}</span>
                {{#if actor.hasPermission}}
                  <!-- Spellcasting Classes Display -->
                  <div class="member-class-info">
                    {{#each actor.spellcasters as |class|}}
                      <span class="class-name">{{class.enhancedClassName}}</span>{{#unless @last}}, {{/unless}}
                    {{/each}}
                  </div>
                {{else}}
                  <!-- No Permission Indicator -->
                  <span class="no-permission-text">{{localize "SPELLBOOK.Party.NoViewPermission"}}</span>
                {{/if}}
              </div>

              <!-- Spell Count Summary - Only visible with permissions -->
              {{#if actor.hasPermission}}
                <div class="spell-counts-compact">
                  <!-- Known Spells Count -->
                  <span class="count-item">
                    <span class="count-number">{{actor.totalSpellsKnown}}</span>
                    <span class="count-label">{{localize "SPELLBOOK.Party.Known"}}</span>
                  </span>
                  <!-- Prepared Spells Count -->
                  <span class="count-item">
                    <span class="count-number">{{actor.totalSpellsPrepared}}</span>
                    <span class="count-label">{{localize "SPELLBOOK.Party.Prepared"}}</span>
                  </span>
                </div>
              {{/if}}
            </div>

            <!-- Spellcasting Focus Display - Interactive settings access -->
            {{#if actor.hasPermission}}
              {{#if actor.selectedFocus}}
                <!-- Active Focus Display -->
                <div class="member-focus-display {{#unless (or @root.user.isGM actor.isOwner)}}read-only{{/unless}}"
                  {{#if (or @root.user.isGM actor.isOwner)}}data-action="openFocusSettings" {{/if}}
                  data-actor-id="{{actor.id}}"
                  data-tooltip="{{#if (or @root.user.isGM actor.isOwner)}}{{localize 'SPELLBOOK.FocusSettings.ClickToEdit'}} - {{/if}}{{actor.selectedFocus}}">
                  {{#if actor.selectedFocusIcon}}
                    <img src="{{actor.selectedFocusIcon}}" alt="{{actor.selectedFocus}}" class="focus-icon">
                  {{else}}
                    <img src="icons/svg/mystery-man.svg" alt="No Focus" class="focus-icon">
                  {{/if}}
                </div>
              {{else}}
                <!-- No Focus Set Indicator -->
                <div class="member-focus-none {{#unless (or @root.user.isGM actor.isOwner)}}read-only{{/unless}}"
                  {{#if (or @root.user.isGM actor.isOwner)}}data-action="openFocusSettings" {{/if}}
                  data-actor-id="{{actor.id}}"
                  data-tooltip="{{#if (or @root.user.isGM actor.isOwner)}}{{localize 'SPELLBOOK.FocusSettings.ClickToSetFocus'}}{{else}}{{localize 'SPELLBOOK.FocusSettings.NoFocusSet'}}{{/if}}">
                  <i class="fas fa-cog"></i>
                </div>
              {{/if}}
            {{/if}}
          </div>
        </div>
      {{/each}}
    </div>
  </section>

  <!-- Spell Comparison Section - Organized display of all party spells by level -->
  <section class="spell-comparison">
    {{#if spellLevels}}
      {{#each spellLevels as |levelGroup|}}
        <!-- Spell Level Group - Collapsible section for each spell level -->
        <div class="spell-level-group" data-spell-level="{{levelGroup.level}}">
          <!-- Level Header - Clickable toggle for expand/collapse -->
          <h4 class="level-header" data-action="toggleSpellLevel" role="button" aria-expanded="true"
            aria-controls="spell-list-{{levelGroup.level}}">
            <i class="fas fa-caret-down collapse-indicator" aria-hidden="true"></i>
            <span class="level-name">{{levelGroup.levelName}}</span>
            <span class="spell-count">({{levelGroup.spells.length}} {{localize "SPELLBOOK.Party.Spells"}})</span>
          </h4>

          <!-- Spells Grid - Individual spell entries with actor status -->
          <div class="spells-grid" id="spell-list-{{levelGroup.level}}">
            {{#each levelGroup.spells as |spell|}}
              <!-- Individual Spell Comparison Item -->
              <div class="spell-comparison-item" data-spell-uuid="{{spell.uuid}}">
                <!-- Spell Name and Icon -->
                <div class="spell-name-section">
                  {{{spell.enrichedIcon}}}
                  <span class="spell-name">{{spell.name}}</span>
                </div>

                <!-- Actor Status Indicators - Shows which actors know/prepare this spell -->
                <div class="spell-actors">
                  {{#each spell.actorStatuses as |actorStatus|}}
                    <span class="actor-spell-status {{actorStatus.status}}"
                      data-actor-id="{{actorStatus.actorId}}">{{actorStatus.name}}</span>
                  {{/each}}
                </div>
              </div>
            {{/each}}
          </div>
        </div>
      {{/each}}
    {{/if}}
  </section>
</div>
