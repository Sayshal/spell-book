{{!--
/**
 * Party Spell Synergy Analysis Template
 *
 * PURPOSE:
 * Comprehensive analytics interface displaying detailed party spell coordination analysis.
 * Provides statistical insights, distribution visualizations, and strategic recommendations
 * to optimize party spellcasting effectiveness and identify preparation opportunities.
 *
 * CONTEXT REQUIREMENTS:
 * @param {Object} analysis - Complete synergy analysis data structure
 * @param {number} analysis.totalSpells - Total unique spells across party members
 * @param {number} analysis.totalPreparedSpells - Total prepared spells across party
 * @param {number} analysis.concentrationSpells - Count of concentration spells
 * @param {number} analysis.concentrationPercentage - Percentage requiring concentration
 * @param {number} analysis.ritualSpells - Count of ritual spells available
 * @param {Array<Object>} analysis.damageDistribution - Damage type analysis with member data
 * @param {Array<Object>} analysis.focusDistribution - Spellcasting focus distribution
 * @param {Array<Object>} analysis.spellSchoolDistribution - School distribution with percentages
 * @param {Array<Object>} analysis.spellLevelDistribution - Level distribution analysis
 * @param {Object} analysis.componentAnalysis - Component usage statistics
 * @param {Array<Object>} analysis.duplicateSpells - Duplicate spell warnings
 * @param {Array<string>} analysis.recommendations - Strategic recommendation keys
 * @param {Array<Object>} analysis.concentrationMembers - Members with concentration spells
 * @param {Array<Object>} analysis.ritualMembers - Members with ritual spells
 * @param {Object} analysis.memberContributions - Detailed member contribution tracking
 *
 * INTERACTIVE FEATURES:
 * - Hover tooltips showing contributing party members for each statistic
 * - Visual progress bars and distribution charts for easy interpretation
 * - Color-coded recommendations with severity indicators
 * - Expandable sections for detailed breakdowns
 * - Member-specific contribution details in tooltips
 *
 * STYLING INTEGRATION:
 * - Uses spell-book CSS variables for consistent theming
 * - Responsive grid layouts for different screen sizes
 * - Hover effects and transitions for enhanced UX
 * - Semantic color coding for different data types
 *
 * LOCALIZATION SUPPORT:
 * - All text content uses SPELLBOOK.Party.Analysis namespace
 * - Damage types and spell schools use D&D 5e localization
 * - Recommendation messages support contextual formatting
 * - Tooltip content includes member names and specific details
 */
--}}

<div class="party-spell-analysis">
  <!-- Analysis Overview Section -->
  <div class="analysis-overview">
    <h3>{{localize "SPELLBOOK.Party.Analysis.Overview"}}</h3>

    <div class="stats-grid">
      <div class="stat-item" data-tooltip="{{localize 'SPELLBOOK.Party.Analysis.TotalSpellsTooltip'}}">
        <span class="stat-label">{{localize "SPELLBOOK.Party.Analysis.TotalSpells"}}</span>
        <span class="stat-value">{{totalSpells}}</span>
      </div>

      <div class="stat-item" data-tooltip="{{localize 'SPELLBOOK.Party.Analysis.TotalPreparedTooltip'}}">
        <span class="stat-label">{{localize "SPELLBOOK.Party.Analysis.TotalPrepared"}}</span>
        <span class="stat-value">{{totalPreparedSpells}}</span>
      </div>

      <div class="stat-item"
        data-tooltip="Members with concentration spells: {{#each concentrationMembers}}{{name}} ({{count}} spells){{#unless @last}}, {{/unless}}{{/each}}{{#if memberContributions.highConcentration}} | High usage: {{#each memberContributions.highConcentration}}{{name}} ({{percentage}}%){{#unless @last}}, {{/unless}}{{/each}}{{/if}}">
        <span class="stat-label">{{localize "DND5E.Concentration"}}</span>
        <span class="stat-value">{{concentrationSpells}} ({{concentrationPercentage}}%)</span>
      </div>

      <div class="stat-item"
        data-tooltip="Members with ritual spells: {{#each ritualMembers}}{{name}} ({{count}} spells){{#unless @last}}, {{/unless}}{{/each}}{{#if memberContributions.lowRitual}} | Low usage: {{#each memberContributions.lowRitual}}{{name}} ({{ritualCount}}/{{totalPrepared}}){{#unless @last}}, {{/unless}}{{/each}}{{/if}}">
        <span class="stat-label">{{localize "DND5E.Ritual"}}</span>
        <span class="stat-value">{{ritualSpells}}</span>
      </div>
    </div>
  </div>

  <!-- Spell School Distribution as Pie Chart -->
  {{#if spellSchoolDistribution.length}}
    <div class="school-analysis">
      <h4>{{localize "DND5E.School"}} {{localize "SPELLBOOK.Party.Analysis.Distribution"}}</h4>
      <div class="school-pie-container">
        <div class="school-pie-chart"></div>
        <div class="school-legend">
          {{#each spellSchoolDistribution as |school|}}
            <div class="school-legend-item"
              data-tooltip="{{school.localizedSchool}} spells: {{#each school.members}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}">
              <span class="school-color" data-school="{{@index}}"></span>
              <span class="school-name">{{school.localizedSchool}}</span>
              <span class="school-count">{{school.count}} ({{school.percentage}}%)</span>
            </div>
          {{/each}}
        </div>
      </div>
    </div>
  {{/if}}

  <!-- Damage Type Distribution -->
  {{#if damageDistribution.length}}
    <div class="damage-analysis">
      <h4>{{localize "DND5E.DamageTypes"}}</h4>
      <div class="damage-types">
        {{#each damageDistribution as |damageData|}}
          <div class="damage-type-item"
            data-tooltip="{{damageData.localizedType}} damage spells: {{#each damageData.members}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}">
            <span class="damage-type">{{damageData.localizedType}}</span>
            <span class="damage-count">{{damageData.count}}</span>
          </div>
        {{/each}}
      </div>
    </div>
  {{/if}}

  <!-- Spell Level Distribution -->
  {{#if spellLevelDistribution.length}}
    <div class="level-analysis">
      <h4>{{localize "DND5E.SpellLevels"}} {{localize "SPELLBOOK.Party.Analysis.Distribution"}}</h4>
      <div class="level-chart">
        {{#each spellLevelDistribution as |level|}}
          <div class="level-item"
            data-tooltip="{{level.localizedLevel}}: {{level.count}} prepared ({{level.percentage}}% of total)">
            <span class="level-label">{{level.localizedLevel}}</span>
            <div class="level-bar" style="width: {{level.percentage}}%">
              <span class="level-count">{{level.count}} ({{level.percentage}}%)</span>
            </div>
          </div>
        {{/each}}
      </div>
    </div>
  {{/if}}

  <!-- Spell Component Analysis -->
  <div class="component-analysis">
    <h4>{{localize "DND5E.Components"}}</h4>
    <div class="component-grid">
      <div class="component-item"
        data-tooltip="{{localize 'SPELLBOOK.Party.Analysis.VerbalTooltip'}}: {{../componentTooltips.verbal}}">
        <span class="component-type">{{localize "DND5E.ComponentVerbalAbbr"}}</span>
        <span class="component-count">{{componentAnalysis.verbal}}</span>
      </div>

      <div class="component-item"
        data-tooltip="{{localize 'SPELLBOOK.Party.Analysis.SomaticTooltip'}}: {{../componentTooltips.somatic}}">
        <span class="component-type">{{localize "DND5E.ComponentSomaticAbbr"}}</span>
        <span class="component-count">{{componentAnalysis.somatic}}</span>
      </div>

      <div class="component-item"
        data-tooltip="{{localize 'SPELLBOOK.Party.Analysis.MaterialTooltip'}}: {{../componentTooltips.material}}">
        <span class="component-type">{{localize "DND5E.ComponentMaterialAbbr"}}</span>
        <span class="component-count">{{componentAnalysis.material}}</span>
      </div>

      <div class="component-item"
        data-tooltip="{{localize 'SPELLBOOK.Party.Analysis.MaterialCostTooltip'}}: {{../componentTooltips.materialCost}}">
        <span class="component-type">{{localize "DND5E.ComponentMaterialAbbr"}}*</span>
        <span class="component-count">{{componentAnalysis.materialCost}}</span>
      </div>
    </div>
  </div>

  <!-- Focus Distribution -->
  {{#if focusDistribution.length}}
    <div class="focus-analysis">
      <h4>{{localize "SPELLBOOK.Party.Analysis.FocusDistribution"}}</h4>
      <div class="focus-types">
        {{#each focusDistribution as |focusData|}}
          <div class="focus-type-item"
            data-tooltip="{{focusData.focus}} focus: {{#each focusData.members}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}">
            <span class="focus-type">{{focusData.focus}}</span>
            <span class="focus-count">{{focusData.count}}</span>
          </div>
        {{/each}}
      </div>
    </div>
  {{/if}}

  <!-- Duplicate Spells Warning -->
  {{#if duplicateSpells.length}}
    <div class="duplicate-analysis">
      <h4>{{localize "SPELLBOOK.Party.Analysis.DuplicateSpells"}}</h4>
      <div class="duplicate-list">
        {{#each duplicateSpells as |duplicate|}}
          <div class="duplicate-item"
            data-tooltip="{{duplicate.name}} is prepared by: {{#each duplicate.actors}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}. Consider coordination to diversify spell selection.">
            <span class="spell-name">{{duplicate.name}}</span>
            <span class="duplicate-count">Ã—{{duplicate.actors.length}}</span>
          </div>
        {{/each}}
      </div>
    </div>
  {{/if}}

  <!-- Recommendations -->
  {{#if recommendations.length}}
    <div class="recommendations">
      <h4>{{localize "SPELLBOOK.Party.Analysis.Recommendations"}}</h4>
      <ul class="recommendation-list">
        {{#each recommendations as |recommendation|}}
          <li class="recommendation-item">{{localize recommendation}}</li>
        {{/each}}
      </ul>
    </div>
  {{/if}}
</div>
