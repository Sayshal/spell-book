<div class="spellbook-settings-form">
  <!-- Notice Area - Validation warnings and information -->
  {{#if hasNotices}}
    <div class="settings-notices">
      {{#each spellcastingClasses as |classData|}}
        <!-- Scale Value Missing Warning -->
        {{#if classData.rules._noScaleValue}}
          <div class="notice warning">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>{{classData.name}}:</strong> {{localize 'SPELLBOOK.Settings.NoScaleValueNotice'}}
          </div>
        {{/if}}

        <!-- Custom Spell List Information -->
        {{#if classData.hasCustomSpellList}}
          <div class="notice info">
            <i class="fas fa-info-circle"></i>
            <strong>{{classData.name}}:</strong>
            {{#if (gt classData.customSpellListCount 1)}}
              {{localize 'SPELLBOOK.Settings.UsingMultipleCustomSpellLists' count=classData.customSpellListCount lists=classData.customSpellListName}}
            {{else}}
              {{localize 'SPELLBOOK.Settings.UsingCustomSpellList' list=classData.customSpellListName}}
            {{/if}}
          </div>
        {{/if}}
      {{/each}}
    </div>
  {{/if}}

  <!-- Global Rule Set Override Section -->
  <fieldset class="settings-fieldset rule-set-fieldset">
    <legend>{{localize 'SPELLBOOK.Settings.GlobalRules'}}</legend>

    <!-- Rule Set Override Setting -->
    <div class="setting-row">
      <i class="fas fa-question-circle setting-tooltip"
        data-tooltip="{{localize 'SPELLBOOK.Settings.RuleSetOverride.Hint'}}"></i>
      <label for="rule-set-override">{{localize 'SPELLBOOK.Settings.RuleSetOverride.Label'}}</label>
      {{{globalSettings.ruleSetSelectHtml}}}
    </div>

    <!-- Enforcement Behavior Setting -->
    <div class="setting-row">
      <i class="fas fa-question-circle setting-tooltip"
        data-tooltip="{{localize 'SPELLBOOK.Settings.EnforcementBehavior.Hint'}}"></i>
      <label for="enforcement-behavior">{{localize 'SPELLBOOK.Settings.EnforcementBehavior.Label'}}</label>
      {{{globalSettings.enforcementSelectHtml}}}
    </div>
  </fieldset>

  <!-- Per-Class Settings Section -->
  {{#if spellcastingClasses.length}}
    <fieldset class="settings-fieldset class-rules-fieldset">
      <legend>{{localize 'SPELLBOOK.Settings.ClassRules.Title'}}</legend>
      <p class="fieldset-description">{{localize 'SPELLBOOK.Settings.ClassRules.Description'}}</p>

      <!-- Class Rules Content -->
      <div class="class-rules-content">
        {{#each spellcastingClasses as |classData|}}
          <div class="class-settings-section {{#if classData.rules._noScaleValue}}has-issues{{/if}}"
            data-class="{{classData.identifier}}">

            <!-- Class Header with Icon and Stats -->
            <div class="class-header">
              {{#if classData.img}}
                <img src="{{classData.img}}" alt="{{classData.name}}" class="class-icon">
              {{/if}}
              <h4>{{classData.name}}</h4>

              <!-- Class Statistics Display -->
              <div class="class-stats">
                {{#if classData.rules.showCantrips}}
                  <span
                    class="cantrip-count">{{localize 'SPELLBOOK.Settings.CantripsKnown' current=classData.stats.currentCantrips max=classData.stats.maxCantrips}}</span>
                {{/if}}

                <!-- Spell Preparation Bonus Display -->
                <span class="preparation-bonus {{#if (ne classData.rules.spellPreparationBonus 0)}}has-bonus{{/if}}">
                  {{#if (gt classData.rules.spellPreparationBonus 0)}}+{{classData.rules.spellPreparationBonus}}{{else if (lt classData.rules.spellPreparationBonus 0)}}{{classData.rules.spellPreparationBonus}}{{else}}±0{{/if}}
                  {{localize 'SPELLBOOK.Settings.SpellPreparationBonus.Text'}}
                </span>

                <!-- Cantrip Preparation Bonus Display -->
                <span class="preparation-bonus {{#if (ne classData.rules.cantripPreparationBonus 0)}}has-bonus{{/if}}">
                  {{#if (gt classData.rules.cantripPreparationBonus 0)}}+{{classData.rules.cantripPreparationBonus}}{{else if (lt classData.rules.cantripPreparationBonus 0)}}{{classData.rules.cantripPreparationBonus}}{{else}}±0{{/if}}
                  {{localize 'SPELLBOOK.Settings.CantripPreparationBonus.Text'}}
                </span>
              </div>
            </div>

            <!-- Class Settings List -->
            <div class="class-settings-list">
              <!-- Show Cantrips Setting -->
              <div class="setting-row{{#if classData.rules._noScaleValue}} disabled{{/if}}">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.ShowCantrips.Hint'}}"></i>
                <label
                  for="show-cantrips-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.ShowCantrips.Label'}}</label>
                {{{classData.formElements.showCantripsCheckboxHtml}}}
                {{#if classData.rules._noScaleValue}}
                  <small class="setting-note warning">{{localize 'SPELLBOOK.Settings.DisabledNoScaleValue'}}</small>
                {{/if}}
              </div>

              <!-- Force Wizard Mode Setting -->
              <div class="setting-row">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.ForceWizardMode.Hint'}}"></i>
                <label
                  for="force-wizard-mode-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.ForceWizardMode.Label'}}</label>
                {{{classData.formElements.forceWizardModeCheckboxHtml}}}
              </div>

              <!-- Cantrip Swapping Setting -->
              <div class="setting-row{{#unless classData.rules.showCantrips}} disabled{{/unless}}">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.CantripSwapping.Hint'}}"></i>
                <label
                  for="cantrip-swapping-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.CantripSwapping.Label'}}</label>
                {{{classData.formElements.cantripSwappingSelectHtml}}}
              </div>

              <!-- Spell Swapping Setting -->
              <div class="setting-row">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.SpellSwapping.Hint'}}"></i>
                <label
                  for="spell-swapping-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.SpellSwapping.Label'}}</label>
                {{{classData.formElements.spellSwappingSelectHtml}}}
              </div>

              <!-- Ritual Casting Setting -->
              <div class="setting-row">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.RitualCasting.Hint'}}"></i>
                <label
                  for="ritual-casting-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.RitualCasting.Label'}}</label>
                {{{classData.formElements.ritualCastingSelectHtml}}}
              </div>

              <!-- Custom Spell Lists Setting (now supports multiple) -->
              <div class="setting-row">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.CustomSpellLists.Hint'}}"></i>
                <label
                  for="custom-spell-lists-{{identifier}}">{{localize 'SPELLBOOK.Settings.CustomSpellLists.Label'}}</label>
                {{{classData.formElements.customSpellListsSelectHtml}}}
              </div>

              <!-- Spell Preparation Bonus Setting -->
              <div class="setting-row">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.SpellPreparationBonus.Hint'}}"></i>
                <label
                  for="spell-preparation-bonus-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.SpellPreparationBonus.Label'}}</label>
                {{{classData.formElements.spellPreparationBonusControlsHtml}}}
              </div>

              <!-- Cantrip Preparation Bonus Setting -->
              <div class="setting-row{{#unless classData.rules.showCantrips}} disabled{{/unless}}">
                <i class="fas fa-question-circle setting-tooltip"
                  data-tooltip="{{localize 'SPELLBOOK.Settings.CantripPreparationBonus.Hint'}}"></i>
                <label
                  for="cantrip-preparation-bonus-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.CantripPreparationBonus.Label'}}</label>
                {{{classData.formElements.cantripPreparationBonusControlsHtml}}}
              </div>

              <!-- Spell Learning Cost Multiplier (Wizard-enabled classes only) -->
              {{#if classData.isWizard}}
                <div class="setting-row">
                  <i class="fas fa-question-circle setting-tooltip"
                    data-tooltip="{{localize 'SPELLBOOK.Settings.SpellLearningCostMultiplier.Hint'}}"></i>
                  <label
                    for="spell-learning-cost-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.SpellLearningCostMultiplier.Label'}}</label>
                  {{{classData.formElements.spellLearningCostControlsHtml}}}
                </div>

                <!-- Spell Learning Time Multiplier (Wizard-enabled classes only) -->
                <div class="setting-row">
                  <i class="fas fa-question-circle setting-tooltip"
                    data-tooltip="{{localize 'SPELLBOOK.Settings.SpellLearningTimeMultiplier.Hint'}}"></i>
                  <label
                    for="spell-learning-time-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.SpellLearningTimeMultiplier.Label'}}</label>
                  {{{classData.formElements.spellLearningTimeControlsHtml}}}
                </div>

                <!-- Starting Spells (Wizard-enabled classes only) -->
                <div class="setting-row">
                  <i class="fas fa-question-circle setting-tooltip"
                    data-tooltip="{{localize 'SPELLBOOK.Settings.StartingSpells.Hint'}}"></i>
                  <label
                    for="starting-spells-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.StartingSpells.Label'}}</label>
                  {{{classData.formElements.startingSpellsControlsHtml}}}
                </div>

                <!-- Spells Per Level (Wizard-enabled classes only) -->
                <div class="setting-row">
                  <i class="fas fa-question-circle setting-tooltip"
                    data-tooltip="{{localize 'SPELLBOOK.Settings.SpellsPerLevel.Hint'}}"></i>
                  <label
                    for="spells-per-level-{{classData.identifier}}">{{localize 'SPELLBOOK.Settings.SpellsPerLevel.Label'}}</label>
                  {{{classData.formElements.spellsPerLevelControlsHtml}}}
                </div>
              {{/if}}
            </div>
          </div>
        {{/each}}
      </div>
    </fieldset>
  {{/if}}

  <!-- Submit Button Section -->
  <div class="submit-section">
    {{{submitButton.submitButtonHtml}}}
  </div>
</div>
