<!-- Right Sidebar: Available spells -->
<div class="available-spells-sidebar">
	<h2>{{localize "SPELLMANAGER.Columns.AvailableSpells"}}</h2>
	<div class="spell-filters">
		<!-- Full width search bar -->
		<div class="filter-search">
			<input type="text" name="spell-search" placeholder="{{localize "SPELLMANAGER.Filters.SearchPlaceholder"}}"
				value="{{filterState.name}}" data-action="filterSpells">
		</div>

		<!-- Grid layout for filters -->
		<div class="filter-grid">
			<!-- Row 1 -->
			<div class="filter-item">
				<select name="spell-level" data-action="filterSpells">
					<option value="">{{localize "SPELLMANAGER.Filters.AllLevels"}}</option>
					{{#each spellLevels as |label level|}}
						<option value="{{level}}" {{#if (eq ../filterState.level level)}}selected{{/if}}>{{label}}</option>
					{{/each}}
				</select>
			</div>

			<div class="filter-item">
				<select name="spell-school" data-action="filterSpells">
					<option value="">{{localize "SPELLMANAGER.Filters.AllSchools"}}</option>
					{{#each spellSchools as |school key|}}
						<option value="{{key}}" {{#if (eq ../filterState.school key)}}selected{{/if}}>{{school.label}}</option>
					{{/each}}
				</select>
			</div>

			<div class="filter-item">
				<select name="spell-castingTime" data-action="filterSpells">
					<option value="">{{localize "SPELLMANAGER.Filters.AllCastingTimes"}}</option>
					<!-- Casting time options would be populated from JS -->
				</select>
			</div>

			<!-- Row 2 -->
			<div class="filter-item">
				<select name="spell-damageType" data-action="filterSpells">
					<option value="">{{localize "SPELLMANAGER.Filters.AllDamageTypes"}}</option>
					<!-- Damage type options would be populated from JS -->
				</select>
			</div>

			<div class="filter-item">
				<select name="spell-condition" data-action="filterSpells">
					<option value="">{{localize "SPELLMANAGER.Filters.AllConditions"}}</option>
					<!-- Condition options would be populated from JS -->
				</select>
			</div>

			<div class="filter-item">
				<select name="spell-requiresSave" data-action="filterSpells">
					<option value="">{{localize "SPELLMANAGER.Filters.AllSaves"}}</option>
					<option value="true">{{localize "SPELLMANAGER.Filters.True"}}</option>
					<option value="false">{{localize "SPELLMANAGER.Filters.False"}}</option>
				</select>
			</div>

			<!-- Row 3 -->
			<div class="filter-item">
				<select name="spell-concentration" data-action="filterSpells">
					<option value="">{{localize "SPELLMANAGER.Filters.AllConcentration"}}</option>
					<option value="true">{{localize "SPELLMANAGER.Filters.True"}}</option>
					<option value="false">{{localize "SPELLMANAGER.Filters.False"}}</option>
				</select>
			</div>

			<div class="filter-item checkbox-filter">
				<label>
					<input type="checkbox" name="spell-prepared" {{#if filterState.prepared}}checked{{/if}}
						data-action="filterSpells">
					{{localize "SPELLMANAGER.Filters.PreparedOnly"}}
				</label>
			</div>

			<div class="filter-item checkbox-filter">
				<label>
					<input type="checkbox" name="spell-ritual" {{#if filterState.ritual}}checked{{/if}}
						data-action="filterSpells">
					{{localize "SPELLMANAGER.Filters.RitualOnly"}}
				</label>
			</div>
		</div>

		<!-- Range filter (full width) -->
		<div class="filter-range">
			<label>{{localize "SPELLMANAGER.Filters.Range"}}</label>
			<div class="range-inputs">
				<input type="number" name="spell-min-range" placeholder="{{localize "SPELLMANAGER.Filters.RangeMin"}}"
					value="{{filterState.minRange}}" data-action="filterSpells">
				<div class="range-separator">-</div>
				<input type="number" name="spell-max-range" placeholder="{{localize "SPELLMANAGER.Filters.RangeMax"}}"
					value="{{filterState.maxRange}}" data-action="filterSpells">
			</div>
		</div>

		<!-- Source filter is moved to the bottom -->
		<div class="filter-item">
			<select name="spell-source" data-action="filterSpells">
				<option value="">{{localize "SPELLMANAGER.Filters.AllSources"}}</option>
				{{#each spellSources as |source|}}
					<option value="{{source.id}}" {{#if (eq ../filterState.source source.id)}}selected{{/if}}>
						{{source.label}}
					</option>
				{{/each}}
			</select>
		</div>
	</div>

	<div class="available-spells-list">
		{{#if isEditing}}
			{{log filteredSpells}}
			{{#if filteredSpells.spells.length}}
				<div class="available-spells-wrapper">
					<ul class="available-spells">
						{{#each filteredSpells.spells as |spell|}}
							<li class="spell-item available" data-uuid="{{spell.uuid}}">
								<div class="spell-name">
									{{{spell.enrichedIcon}}}
									<div class="name-stacked">
										<span class="title">{{spell.name}}</span>
										<span class="subtitle">{{spell.formattedDetails}}</span>
									</div>
								</div>
								<div class="spell-meta">
									<button type="button" class="add-spell" data-action="addSpell" data-uuid="{{spell.uuid}}">
										<i class="fas fa-plus"></i>
									</button>
								</div>
							</li>
						{{/each}}
					</ul>
				</div>
				{{#if filteredSpells.totalItems}}
					<div class="pagination-controls">
						<div class="pagination-status">
							{{localize "SPELLMANAGER.Filters.Showing"}}
							{{add (multiply paginationState.currentPage paginationState.pageSize) 1}}-{{min (add (multiply paginationState.currentPage paginationState.pageSize) paginationState.pageSize) filteredSpells.totalFiltered}}
							{{localize "SPELLMANAGER.Filters.Of"}} {{filteredSpells.totalFiltered}}
							{{localize "SPELLMANAGER.Filters.Spells"}}
						</div>
						<div class="pagination-buttons">
							<button type="button" class="pagination-button" data-action="pageNavigation" data-page-action="first-page"
								{{#if (eq paginationState.currentPage 0)}}disabled{{/if}}>
								<i class="fas fa-angle-double-left"></i>
							</button>
							<button type="button" class="pagination-button" data-action="pageNavigation" data-page-action="prev-page"
								{{#if (eq paginationState.currentPage 0)}}disabled{{/if}}>
								<i class="fas fa-angle-left"></i>
							</button>
							<button type="button" class="pagination-button" data-action="pageNavigation" data-page-action="next-page"
								{{#if (eq paginationState.currentPage (subtract paginationState.totalPages 1))}}disabled{{/if}}>
								<i class="fas fa-angle-right"></i>
							</button>
							<button type="button" class="pagination-button" data-action="pageNavigation" data-page-action="last-page"
								{{#if (eq paginationState.currentPage (subtract paginationState.totalPages 1))}}disabled{{/if}}>
								<i class="fas fa-angle-double-right"></i>
							</button>
						</div>
						{{#if (gt paginationState.totalPages 1)}}
							<span class="pagination-pages">
								{{localize "SPELLMANAGER.Filters.Page"}} {{add paginationState.currentPage 1}}
								{{localize "SPELLMANAGER.Filters.Of"}} {{paginationState.totalPages}}
							</span>
						{{/if}}
					</div>
				{{/if}}
			{{else}}
				<p class="no-spells">{{localize "SPELLMANAGER.Columns.NoMatchingSpells"}}</p>
			{{/if}}
		{{else}}
			<p class="phase-notice">{{localize "SPELLMANAGER.Columns.EditPrompt"}}</p>
		{{/if}}
	</div>
</div>
